AutoParts Kenya Backend - Complete Folder Structure
=====================================================

autoparts_kenya/
â”œâ”€â”€ README.md                           # Project overview (setup, features, deployment guide)
â”œâ”€â”€ INSTALLATION.md                     # Step-by-step installation & troubleshooting
â”œâ”€â”€ API_ENDPOINTS.md                    # Complete API reference with curl examples
â”œâ”€â”€ PROJECT_STRUCTURE.md                # Detailed module descriptions & architecture
â”œâ”€â”€ IMPLEMENTATION_COMPLETE.md          # Completion checklist & summary
â”œâ”€â”€ requirements.txt                    # Python dependencies (Django, DRF, Celery, etc.)
â”œâ”€â”€ manage.py                           # Django management script
â”œâ”€â”€ docker-compose.yml                  # Docker Compose (PostgreSQL, Redis, Web, Celery)
â”œâ”€â”€ Dockerfile                          # Docker image for services
â”œâ”€â”€ .env.example                        # Environment variables template
â”œâ”€â”€ .gitignore                          # Git ignore rules
â”‚
â”œâ”€â”€ ğŸ“ autoparts_kenya/                 # Main Django project config
â”‚   â”œâ”€â”€ __init__.py                     # Celery app initialization
â”‚   â”œâ”€â”€ settings.py                     # Full Django configuration (5.1+)
â”‚   â”‚                                   # - PostgreSQL setup
â”‚   â”‚                                   # - JWT authentication
â”‚   â”‚                                   # - DRF + drf-spectacular
â”‚   â”‚                                   # - Celery + Redis
â”‚   â”‚                                   # - CORS, logging, security
â”‚   â”‚                                   # - Kenyan timezone & M-Pesa config
â”‚   â”œâ”€â”€ urls.py                         # Root URL routing
â”‚   â”‚                                   # - /api/v1/ â†’ apps
â”‚   â”‚                                   # - /api/schema/ â†’ OpenAPI schema
â”‚   â”‚                                   # - /api/docs/ â†’ Swagger
â”‚   â”‚                                   # - /api/redoc/ â†’ ReDoc
â”‚   â”‚                                   # - /health/ â†’ health check
â”‚   â”œâ”€â”€ asgi.py                         # ASGI server config
â”‚   â”œâ”€â”€ wsgi.py                         # WSGI server config
â”‚   â””â”€â”€ celery.py                       # Celery app setup
â”‚                                       # - Redis broker & result backend
â”‚                                       # - Beat schedule (hourly low stock check)
â”‚
â”œâ”€â”€ ğŸ“ core/                            # Shared utilities & permissions
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ apps.py
â”‚   â”œâ”€â”€ permissions.py                  # Custom permissions
â”‚   â”‚                                   # - IsOwner (boolean: is_owner flag)
â”‚   â”‚                                   # - IsOwnerOrReadOnly (write/read separation)
â”‚   â”‚                                   # - IsAuthenticatedOrReadOnly (guest-first)
â”‚   â”‚                                   # - IsOwnerOrCreateOnly (registration)
â”‚   â””â”€â”€ utils.py                        # Utility functions
â”‚                                       # - calculate_delivery_time(city, type)
â”‚                                       # - validate_mpesa_phone_number()
â”‚                                       # - calculate_order_total_with_delivery()
â”‚                                       # - format_kenyan_currency()
â”‚                                       # - is_store_owner()
â”‚
â”œâ”€â”€ ğŸ“ users/                           # User authentication & profiles
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ apps.py
â”‚   â”œâ”€â”€ models.py                       # Database models
â”‚   â”‚                                   # - User (Django built-in)
â”‚   â”‚                                   # - UserProfile (one-to-one)
â”‚   â”‚                                   #   - is_owner (boolean flag for store owner)
â”‚   â”‚                                   #   - phone_number, avatar_url, bio
â”‚   â”‚                                   #   - business_registration, tax_id
â”‚   â”‚                                   #   - email/sms notifications prefs
â”‚   â”‚                                   # - SavedVehicle (FK user)
â”‚   â”‚                                   #   - make, model, year, nickname
â”‚   â”‚                                   #   - is_primary (quick filter vehicle)
â”‚   â”‚                                   # - SavedAddress (FK user)
â”‚   â”‚                                   #   - address_type (home/work/other)
â”‚   â”‚                                   #   - delivery details
â”‚   â”‚                                   #   - recipient info
â”‚   â”‚                                   #   - is_default
â”‚   â”œâ”€â”€ serializers.py                  # API serializers
â”‚   â”‚                                   # - UserRegistrationSerializer (guestâ†’user)
â”‚   â”‚                                   # - UserProfileSerializer (detail, updates)
â”‚   â”‚                                   # - SavedVehicleSerializer (CRUD)
â”‚   â”‚                                   # - SavedAddressSerializer (CRUD)
â”‚   â”œâ”€â”€ views.py                        # API views
â”‚   â”‚                                   # - RegistrationView (POST, public)
â”‚   â”‚                                   # - ProfileView (GET/PATCH, auth-only)
â”‚   â”‚                                   # - SavedVehicleViewSet (CRUD, auth-only)
â”‚   â”‚                                   # - SavedAddressViewSet (CRUD, auth-only)
â”‚   â”‚                                   # All @extend_schema documented
â”‚   â””â”€â”€ urls.py                         # URL routing
â”‚                                       # - /register/ (POST)
â”‚                                       # - /token/ (POST - get JWT)
â”‚                                       # - /token/refresh/ (POST - refresh JWT)
â”‚                                       # - /profile/ (GET/PATCH)
â”‚                                       # - /saved-vehicles/ (CRUD)
â”‚                                       # - /saved-addresses/ (CRUD)
â”‚
â”œâ”€â”€ ğŸ“ vehicles/                        # Vehicle compatibility system
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ apps.py
â”‚   â”œâ”€â”€ models.py                       # Database models
â”‚   â”‚                                   # - VehicleMake (e.g., Toyota, Nissan)
â”‚   â”‚                                   #   - name (unique), country, logo_url
â”‚   â”‚                                   # - VehicleModel (e.g., Corolla)
â”‚   â”‚                                   #   - FK VehicleMake
â”‚   â”‚                                   #   - name, year_from, year_to
â”‚   â”‚                                   #   - engine_type (1.6L Petrol, etc.)
â”‚   â”‚                                   #   - is_compatible_with_year(year)
â”‚   â”œâ”€â”€ serializers.py                  # API serializers
â”‚   â”‚                                   # - VehicleMakeSerializer (list + detail)
â”‚   â”‚                                   # - VehicleModelSerializer (list + detail)
â”‚   â”œâ”€â”€ views.py                        # API views
â”‚   â”‚                                   # - VehicleMakeViewSet
â”‚   â”‚                                   #   - GET public, POST/PUT/DELETE owner-only
â”‚   â”‚                                   # - VehicleModelViewSet
â”‚   â”‚                                   #   - Filtering: by make, year range
â”‚   â”‚                                   #   - Search: name, make, engine
â”‚   â”‚                                   #   - GET public, write owner-only
â”‚   â”‚                                   # All @extend_schema documented
â”‚   â””â”€â”€ urls.py                         # Router for ViewSets
â”‚
â”œâ”€â”€ ğŸ“ products/                        # Product catalog
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ apps.py
â”‚   â”œâ”€â”€ models.py                       # Database models
â”‚   â”‚                                   # - Category (e.g., Engine Parts)
â”‚   â”‚                                   #   - name, slug, icon_url, image_url
â”‚   â”‚                                   #   - parent FK (subcategories)
â”‚   â”‚                                   #   - is_active, display_order
â”‚   â”‚                                   # - Product (core model)
â”‚   â”‚                                   #   - name, slug, sku (unique)
â”‚   â”‚                                   #   - category FK
â”‚   â”‚                                   #   - compatible_vehicles M2M VehicleModel â­
â”‚   â”‚                                   #   - price, cost_price, discount_percentage
â”‚   â”‚                                   #   - stock, reserved_stock
â”‚   â”‚                                   #   - primary_image (ImageField)
â”‚   â”‚                                   #   - is_featured, is_active
â”‚   â”‚                                   #   - rating, review_count
â”‚   â”‚                                   #   - Properties: available_stock, discounted_price
â”‚   â”‚                                   #   - Methods: profit_margin, is_in_stock()
â”‚   â”‚                                   # - ProductImage (gallery)
â”‚   â”‚                                   #   - FK product, image, alt_text, order
â”‚   â”œâ”€â”€ serializers.py                  # API serializers
â”‚   â”‚                                   # - CategorySerializer (list + detail)
â”‚   â”‚                                   # - ProductListSerializer (lightweight)
â”‚   â”‚                                   # - ProductDetailSerializer (full + vehicles)
â”‚   â”‚                                   # - ProductCreateUpdateSerializer (owner)
â”‚   â”œâ”€â”€ views.py                        # API views
â”‚   â”‚                                   # - CategoryViewSet (owner write, public read)
â”‚   â”‚                                   # - ProductViewSet
â”‚   â”‚                                   #   - ADVANCED FILTERING â­
â”‚   â”‚                                   #     â€¢ vehicle_make, vehicle_model, vehicle_year
â”‚   â”‚                                   #     â€¢ price_min, price_max
â”‚   â”‚                                   #     â€¢ category
â”‚   â”‚                                   #     â€¢ in_stock (boolean)
â”‚   â”‚                                   #   - Search: name, SKU, description
â”‚   â”‚                                   #   - Ordering: price, rating, stock, created_at
â”‚   â”‚                                   #   - Actions: featured(), by_vehicle()
â”‚   â”‚                                   # All @extend_schema with examples
â”‚   â”œâ”€â”€ tasks.py                        # Celery tasks
â”‚   â”‚                                   # - check_low_stock() (hourly)
â”‚   â””â”€â”€ urls.py                         # Router
â”‚
â”œâ”€â”€ ğŸ“ orders/                          # Checkout & order management
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ apps.py
â”‚   â”œâ”€â”€ models.py                       # Database models
â”‚   â”‚                                   # - Order (guest + auth support) â­
â”‚   â”‚                                   #   - user FK (nullable for guests)
â”‚   â”‚                                   #   - guest_email, guest_phone
â”‚   â”‚                                   #   - order_number (unique, generated)
â”‚   â”‚                                   #   - delivery: address, city, postal_code
â”‚   â”‚                                   #   - recipient: name, phone
â”‚   â”‚                                   #   - pricing: subtotal, delivery_cost, total
â”‚   â”‚                                   #   - status: pending, confirmed, processing, shipped, delivered, cancelled
â”‚   â”‚                                   #   - payment_status: unpaid, pending, paid, failed, refunded
â”‚   â”‚                                   #   - customer_notes, admin_notes
â”‚   â”‚                                   #   - timestamps: paid_at, shipped_at, delivered_at
â”‚   â”‚                                   #   - Properties: customer_email, customer_phone
â”‚   â”‚                                   #   - Methods: get_item_count()
â”‚   â”‚                                   # - OrderItem (line items)
â”‚   â”‚                                   #   - FK order, product (nullable)
â”‚   â”‚                                   #   - product_name, product_sku (snapshot)
â”‚   â”‚                                   #   - unit_price, quantity
â”‚   â”‚                                   #   - line_total (auto-calculated)
â”‚   â”œâ”€â”€ serializers.py                  # API serializers
â”‚   â”‚                                   # - OrderItemCreateSerializer
â”‚   â”‚                                   # - OrderCreateSerializer â­
â”‚   â”‚                                   #   - Cart (items validation)
â”‚   â”‚                                   #   - Delivery address (required)
â”‚   â”‚                                   #   - Guest email (if not authenticated)
â”‚   â”‚                                   #   - Calculates totals & delivery cost
â”‚   â”‚                                   #   - Checks stock availability
â”‚   â”‚                                   #   - Reserves stock on creation
â”‚   â”‚                                   # - OrderListSerializer (summary)
â”‚   â”‚                                   # - OrderDetailSerializer (full + items)
â”‚   â”œâ”€â”€ views.py                        # API views
â”‚   â”‚                                   # - CheckoutView (POST, public, guests + auth)
â”‚   â”‚                                   # - OrderListView (jwt-only, user's orders)
â”‚   â”‚                                   # - OrderDetailView (public read, auth/owner only)
â”‚   â”‚                                   # - OwnerOrdersViewSet (admin management)
â”‚   â”‚                                   #   - List all orders (filtering by status)
â”‚   â”‚                                   #   - Update order status & notes
â”‚   â”‚                                   # All @extend_schema documented
â”‚   â””â”€â”€ urls.py                         # Routes
â”‚
â”œâ”€â”€ ğŸ“ payments/                        # M-Pesa integration
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ apps.py
â”‚   â”œâ”€â”€ models.py                       # Database models
â”‚   â”‚                                   # - TransactionLog (audit trail) â­
â”‚   â”‚                                   #   - FK order
â”‚   â”‚                                   #   - transaction_type: stk_initiate, stk_timeout,
â”‚   â”‚                                   #     user_cancel, payment_success, payment_failed
â”‚   â”‚                                   #   - M-Pesa IDs: merchant_request_id, checkout_request_id
â”‚   â”‚                                   #   - phone_number, amount
â”‚   â”‚                                   #   - response_code, response_description
â”‚   â”‚                                   #   - mpesa_receipt (for successful payments)
â”‚   â”‚                                   #   - raw_response (JSON for debugging)
â”‚   â”œâ”€â”€ utils.py                        # M-Pesa utilities
â”‚   â”‚                                   # - DarajaAPI class â­
â”‚   â”‚                                   #   - get_access_token() (OAuth)
â”‚   â”‚                                   #   - initiate_stk_push(phone, amount, order#)
â”‚   â”‚                                   #   - validate_callback()
â”‚   â”‚                                   #   - Supports sandbox & production
â”‚   â”œâ”€â”€ serializers.py                  # API serializers
â”‚   â”‚                                   # - STKPushSerializer
â”‚   â”‚                                   # - CallbackSerializer
â”‚   â”œâ”€â”€ views.py                        # API views â­
â”‚   â”‚                                   # - STKPushInitiateView (POST, public)
â”‚   â”‚                                   #   - order_id, phone_number
â”‚   â”‚                                   #   - Calls DarajaAPI.initiate_stk_push()
â”‚   â”‚                                   #   - Returns merchant/checkout IDs
â”‚   â”‚                                   # - mpesa_callback_webhook() (POST, @csrf_exempt)
â”‚   â”‚                                   #   - M-Pesa sends callback here
â”‚   â”‚                                   #   - Queues async Celery task
â”‚   â”‚                                   #   - Returns quick 200 to Safaricom
â”‚   â”‚                                   # - check_payment_status() (GET, jwt-only)
â”‚   â”‚                                   # All @extend_schema documented
â”‚   â”œâ”€â”€ tasks.py                        # Celery tasks
â”‚   â”‚                                   # - process_mpesa_callback() â­ (async)
â”‚   â”‚                                   #   - Parses callback from M-Pesa
â”‚   â”‚                                   #   - If ResultCode==0: paid â†’ confirmed
â”‚   â”‚                                   #   - If ResultCode==1: user cancelled
â”‚   â”‚                                   #   - Else: payment failed
â”‚   â”‚                                   #   - Updates order status & logs transaction
â”‚   â”‚                                   #   - Non-blocking (doesn't timeout webhook)
â”‚   â””â”€â”€ urls.py                         # Routes
â”‚
â”œâ”€â”€ ğŸ“ analytics/                       # Owner-only dashboard
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ apps.py
â”‚   â”œâ”€â”€ views.py                        # API views (owner-only) â­
â”‚   â”‚                                   # - DashboardView
â”‚   â”‚                                   #   - total_revenue, orders, products, low_stock
â”‚   â”‚                                   # - revenue_analytics()
â”‚   â”‚                                   #   - By day, week, month
â”‚   â”‚                                   #   - Count, average order value
â”‚   â”‚                                   # - top_products()
â”‚   â”‚                                   #   - Quantity sold, revenue (limit configurable)
â”‚   â”‚                                   # - low_stock_alert()
â”‚   â”‚                                   #   - Below threshold (default 10)
â”‚   â”‚                                   # - order_status_dist()
â”‚   â”‚                                   #   - Count by status
â”‚   â”‚                                   # - payment_status_dist()
â”‚   â”‚                                   #   - Count & revenue by payment status
â”‚   â”‚                                   # - profit_analysis()
â”‚   â”‚                                   #   - Cost price-based profit margin
â”‚   â”‚                                   # All @extend_schema documented
â”‚   â””â”€â”€ urls.py                         # Routes
â”‚
â”œâ”€â”€ ğŸ“ media/                           # User-uploaded files
â”‚   â””â”€â”€ products/                       # Product images
â”‚       â”œâ”€â”€ 2025/
â”‚       â”‚   â””â”€â”€ 02/                     # Auto-created by Django
â”‚       â”‚       â”œâ”€â”€ product1.jpg
â”‚       â”‚       â”œâ”€â”€ product2.png
â”‚       â”‚       â””â”€â”€ ...
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸ“ logs/                            # Application logs
â”‚   â””â”€â”€ autoparts.log                   # Rotating file handler (10MB max)
â”‚
â””â”€â”€ ğŸ“ staticfiles/                     # Collected static files (production)
    â”œâ”€â”€ admin/
    â”œâ”€â”€ drf-spectacular/
    â””â”€â”€ ...


TOTAL STRUCTURE:
================
- 7 Django Apps (core, users, vehicles, products, orders, payments, analytics)
- ~50+ Python modules (models, views, serializers, tasks, permissions, utils)
- ~3000+ lines of documented code
- 28+ API endpoints with @extend_schema Swagger documentation
- 9 comprehensive documentation files
- Docker support (Dockerfile + docker-compose.yml)
- Production-ready configuration
- Full M-Pesa integration
- Guest checkout support
- Advanced product filtering (vehicle compatibility)
- Owner analytics dashboard
- Celery async tasks
- PostgreSQL + Redis


KEY HIGHLIGHTS:
===============
âœ… Single-owner e-commerce API (not multi-vendor marketplace)
âœ… Guest-first philosophy (public GET, auth POST/PUT/DELETE)
âœ… M-Pesa STK Push integration (sandbox & production)
âœ… Vehicle compatibility filtering (make/model/year)
âœ… Complete order management (guestâ†’registered user conversion)
âœ… Owner analytics dashboard (revenue, top products, profit)
âœ… Async payment processing (Celery + Redis)
âœ… Comprehensive API documentation (Swagger + ReDoc)
âœ… Kenyan localization (timezone, currency, phone format)
âœ… Production-ready security (JWT, CORS, rate limiting, HTTPS)
âœ… Docker support for easy deployment
âœ… Database indexed for performance
âœ… Pagination & filtering throughout

---
Created: February 6, 2025
Version: 1.0.0
Status: âœ… COMPLETE & READY FOR DEPLOYMENT
